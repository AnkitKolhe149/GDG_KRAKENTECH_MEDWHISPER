{% extends "base.html" %}

{% block title %}Feedback - MedWhisper{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='feedback.css') }}">
{% endblock %}

{% block content %}
<div class="container py-5">
    <!-- Header Section with Statistics -->
    <div class="row mb-5">
        <div class="col-12 text-center">
            <div class="feedback-header-badge mb-4">
                <i class="fas fa-comments fa-3x"></i>
            </div>
            <h1 class="display-4 fw-bold mb-4" style="color: var(--heading-color);">We Value Your Voice</h1>
            <p class="lead text-muted" style="font-size: 1.2rem; max-width: 700px; margin: 0 auto;">
                Your feedback shapes the future of MedWhisper. Join <strong>10,000+ users</strong> helping us build the best AI health platform.
            </p>
        </div>
    </div>

    <!-- Stats Bar -->
    <div class="row mb-5">
        <div class="col-md-3 col-6 mb-3">
            <div class="stat-box">
                <div class="stat-number">10K+</div>
                <div class="stat-label">Feedback Received</div>
            </div>
        </div>
        <div class="col-md-3 col-6 mb-3">
            <div class="stat-box">
                <div class="stat-number">98%</div>
                <div class="stat-label">Satisfaction Rate</div>
            </div>
        </div>
        <div class="col-md-3 col-6 mb-3">
            <div class="stat-box">
                <div class="stat-number">5-7</div>
                <div class="stat-label">Days Response</div>
            </div>
        </div>
        <div class="col-md-3 col-6 mb-3">
            <div class="stat-box">
                <div class="stat-number">250+</div>
                <div class="stat-label">Features Added</div>
            </div>
        </div>
    </div>

    <!-- Why Your Feedback Matters -->
    <div class="row mb-5">
        <div class="col-lg-10 offset-lg-1">
            <div class="importance-card">
                <h3 class="text-center mb-4" style="color: var(--heading-color);">
                    <i class="fas fa-lightbulb text-warning me-2"></i>Why Your Feedback Matters
                </h3>
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <div class="impact-item">
                            <i class="fas fa-check-circle text-success me-2"></i>
                            <span>Improve AI accuracy</span>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="impact-item">
                            <i class="fas fa-check-circle text-success me-2"></i>
                            <span>Add new features</span>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="impact-item">
                            <i class="fas fa-check-circle text-success me-2"></i>
                            <span>Better user experience</span>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="impact-item">
                            <i class="fas fa-check-circle text-success me-2"></i>
                            <span>Fix bugs faster</span>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="impact-item">
                            <i class="fas fa-check-circle text-success me-2"></i>
                            <span>Shape our roadmap</span>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="impact-item">
                            <i class="fas fa-check-circle text-success me-2"></i>
                            <span>Help save lives</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Feedback Form Container -->
    <div class="row">
        <div class="col-lg-8 offset-lg-2">
            <div class="feedback-card">
                <div class="card-body p-5">
                    <form id="feedbackForm" method="POST" action="/api/feedback/submit">
                        <!-- Name Field -->
                        <div class="mb-4">
                            <label for="feedbackName" class="form-label fw-bold">Your Name</label>
                            <input type="text" class="form-control form-control-lg" id="feedbackName" 
                                   name="name" placeholder="Enter your name" required>
                            <small class="text-muted">We'd love to know who you are</small>
                        </div>

                        <!-- Email Field -->
                        <div class="mb-4">
                            <label for="feedbackEmail" class="form-label fw-bold">Email Address</label>
                            <input type="email" class="form-control form-control-lg" id="feedbackEmail" 
                                   name="email" placeholder="Enter your email" required>
                            <small class="text-muted">We may follow up with you regarding your feedback</small>
                        </div>

                        <!-- Feedback Category -->
                        <div class="mb-4">
                            <label for="feedbackCategory" class="form-label fw-bold">Feedback Category</label>
                            <select class="form-select form-select-lg" id="feedbackCategory" 
                                    name="category" required>
                                <option value="">-- Select a category --</option>
                                <option value="feature-request">Feature Request</option>
                                <option value="bug-report">Bug Report</option>
                                <option value="improvement">Improvement Suggestion</option>
                                <option value="user-experience">User Experience</option>
                                <option value="data-accuracy">Data Accuracy</option>
                                <option value="general">General Feedback</option>
                                <option value="other">Other</option>
                            </select>
                        </div>

                        <!-- Rating -->
                        <div class="mb-4">
                            <label class="form-label fw-bold">How would you rate MedWhisper?</label>
                            <div class="rating-stars">
                                <div class="star-group" id="ratingStars">
                                    <i class="fas fa-star" data-value="1"></i>
                                    <i class="fas fa-star" data-value="2"></i>
                                    <i class="fas fa-star" data-value="3"></i>
                                    <i class="fas fa-star" data-value="4"></i>
                                    <i class="fas fa-star" data-value="5"></i>
                                </div>
                            </div>
                            <input type="hidden" id="ratingValue" name="rating" value="0">
                        </div>

                        <!-- Feedback Message -->
                        <div class="mb-4">
                            <label for="feedbackMessage" class="form-label fw-bold">Your Feedback</label>
                            <textarea class="form-control form-control-lg" id="feedbackMessage" 
                                      name="message" rows="6" placeholder="Tell us what you think..." 
                                      required style="resize: vertical;"></textarea>
                            <small class="text-muted">Please provide detailed feedback (minimum 10 characters)</small>
                        </div>

                        <!-- Checkbox: Follow-up Permission -->
                        <div class="mb-4">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="followUpPermission" 
                                       name="allow_followup" value="true">
                                <label class="form-check-label" for="followUpPermission">
                                    I'd like to be contacted regarding my feedback
                                </label>
                            </div>
                        </div>

                        <!-- Submit Button -->
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="fas fa-paper-plane me-2"></i>Submit Feedback
                            </button>
                        </div>
                    </form>

                    <!-- Success Message (hidden by default) -->
                    <div id="successMessage" class="alert alert-success d-none mt-4" role="alert">
                        <i class="fas fa-check-circle me-2"></i>
                        <strong>Thank you!</strong> Your feedback has been received. We appreciate your contribution!
                    </div>

                    <!-- Error Message (hidden by default) -->
                    <div id="errorMessage" class="alert alert-danger d-none mt-4" role="alert">
                        <i class="fas fa-exclamation-circle me-2"></i>
                        <strong>Oops!</strong> Something went wrong. Please try again later.
                    </div>
                </div>
            </div>

            <!-- Additional Info -->
            <div class="row mt-5">
                <div class="col-md-6">
                    <div class="info-box">
                        <h5 class="mb-3">
                            <i class="fas fa-info-circle text-info me-2"></i>Quick Tips
                        </h5>
                        <ul class="list-unstyled text-muted small">
                            <li class="mb-2">✓ Be specific and detailed</li>
                            <li class="mb-2">✓ Include examples when possible</li>
                            <li class="mb-2">✓ Explain the impact of your issue</li>
                            <li class="mb-2">✓ One topic per submission</li>
                        </ul>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="info-box">
                        <h5 class="mb-3">
                            <i class="fas fa-question-circle text-success me-2"></i>Response Time
                        </h5>
                        <p class="text-muted small">
                            We review all feedback within <strong>5-7 business days</strong>. 
                            For urgent issues, please contact support directly.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Star Rating Functionality
document.querySelectorAll('#ratingStars i').forEach(star => {
    star.addEventListener('click', function() {
        const value = this.getAttribute('data-value');
        document.getElementById('ratingValue').value = value;
        
        // Update visual stars
        document.querySelectorAll('#ratingStars i').forEach(s => {
            if (s.getAttribute('data-value') <= value) {
                s.classList.remove('far');
                s.classList.add('fas');
            } else {
                s.classList.remove('fas');
                s.classList.add('far');
            }
        });
    });
    
    // Hover effect
    star.addEventListener('mouseover', function() {
        const value = this.getAttribute('data-value');
        document.querySelectorAll('#ratingStars i').forEach(s => {
            if (s.getAttribute('data-value') <= value) {
                s.style.color = '#ffc107';
            } else {
                s.style.color = '#e0e0e0';
            }
        });
    });
});

document.getElementById('ratingStars').addEventListener('mouseleave', function() {
    const value = document.getElementById('ratingValue').value;
    document.querySelectorAll('#ratingStars i').forEach(s => {
        if (s.getAttribute('data-value') <= value) {
            s.style.color = '#ffc107';
        } else {
            s.style.color = '#e0e0e0';
        }
    });
});

// Form Submission
document.getElementById('feedbackForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const formData = {
        name: document.getElementById('feedbackName').value,
        email: document.getElementById('feedbackEmail').value,
        category: document.getElementById('feedbackCategory').value,
        rating: document.getElementById('ratingValue').value,
        message: document.getElementById('feedbackMessage').value,
        allow_followup: document.getElementById('followUpPermission').checked
    };
    
    try {
        const response = await fetch('/api/feedback/submit', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData)
        });
        
        if (response.ok) {
            document.getElementById('feedbackForm').reset();
            document.getElementById('successMessage').classList.remove('d-none');
            document.getElementById('errorMessage').classList.add('d-none');
            // Reset stars
            document.querySelectorAll('#ratingStars i').forEach(s => {
                s.classList.remove('fas');
                s.classList.add('far');
                s.style.color = '#e0e0e0';
            });
            setTimeout(() => {
                document.getElementById('successMessage').classList.add('d-none');
            }, 5000);
        } else {
            document.getElementById('errorMessage').classList.remove('d-none');
            document.getElementById('successMessage').classList.add('d-none');
        }
    } catch (error) {
        console.error('Error:', error);
        document.getElementById('errorMessage').classList.remove('d-none');
        document.getElementById('successMessage').classList.add('d-none');
    }
});
</script>
{% endblock %}
